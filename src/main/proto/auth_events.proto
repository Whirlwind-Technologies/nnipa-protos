syntax = "proto3";

package com.nnipa.proto.auth;

option java_package = "com.nnipa.proto.auth";
option java_outer_classname = "AuthEventProtos";
option java_multiple_files = true;

import "google/protobuf/timestamp.proto";
import "common.proto";

// ============================================
// Authentication Domain Events
// ============================================

// Event: User Registered
message UserRegisteredEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;

  message RegistrationData {
    string user_id = 1;
    string tenant_id = 2;
    string username = 3;
    string email = 4;
    string registration_method = 5;  // self_registration, admin_created, oauth, saml, etc.
    google.protobuf.Timestamp registered_at = 6;
    string ip_address = 7;
    string user_agent = 8;
    bool email_verified = 9;
    string registration_source = 10;  // web, mobile, api, etc.
    map<string, string> additional_info = 11;
  }

  RegistrationData registration = 2;
}

// Event: User Login
message UserLoginEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;

  message LoginData {
    string user_id = 1;
    string tenant_id = 2;
    string username = 3;
    string email = 4;
    string authentication_method = 5;  // password, oauth, saml, etc.
    string ip_address = 6;
    string user_agent = 7;
    string session_id = 8;
    google.protobuf.Timestamp login_time = 9;
    bool mfa_used = 10;
    string device_id = 11;
    map<string, string> additional_info = 12;
  }

  LoginData login = 2;
}

// Event: User Logout
message UserLogoutEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;

  message LogoutData {
    string user_id = 1;
    string tenant_id = 2;
    string session_id = 3;
    google.protobuf.Timestamp logout_time = 4;
    string logout_reason = 5;  // manual, timeout, forced, etc.
    int64 session_duration_ms = 6;
  }

  LogoutData logout = 2;
}

// Event: Login Failed
message LoginFailedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;

  message FailureData {
    string username = 1;
    string tenant_id = 2;
    string failure_reason = 3;
    string ip_address = 4;
    string user_agent = 5;
    google.protobuf.Timestamp attempt_time = 6;
    int32 failure_count = 7;
    bool account_locked = 8;
  }

  FailureData failure = 2;
}

// Event: Password Changed
message PasswordChangedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string user_id = 2;
  string tenant_id = 3;
  string changed_by = 4;  // user_id or "system"
  google.protobuf.Timestamp changed_at = 5;
  bool forced_change = 6;
  string change_reason = 7;
}

// Event: Password Reset Requested
message PasswordResetRequestedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string user_id = 2;
  string email = 3;
  string tenant_id = 4;
  string reset_token = 5;
  google.protobuf.Timestamp requested_at = 6;
  google.protobuf.Timestamp expires_at = 7;
  string ip_address = 8;
}

// Event: Password Reset Completed
message PasswordResetCompletedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string user_id = 2;
  string tenant_id = 3;
  google.protobuf.Timestamp reset_at = 4;
  string ip_address = 5;
}

// Event: MFA Enabled
message MFAEnabledEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string user_id = 2;
  string tenant_id = 3;
  string mfa_type = 4;  // totp, sms, email, etc.
  google.protobuf.Timestamp enabled_at = 5;
  string device_name = 6;
}

// Event: MFA Disabled
message MFADisabledEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string user_id = 2;
  string tenant_id = 3;
  string mfa_type = 4;
  google.protobuf.Timestamp disabled_at = 5;
  string disabled_by = 6;
  string reason = 7;
}

// Event: Token Generated
message TokenGeneratedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;

  message TokenData {
    string user_id = 1;
    string tenant_id = 2;
    string token_type = 3;  // access, refresh, api_key
    string token_id = 4;
    google.protobuf.Timestamp issued_at = 5;
    google.protobuf.Timestamp expires_at = 6;
    repeated string scopes = 7;
    string issued_to = 8;  // client_id or application..
  }

  TokenData token = 2;
}

// Event: Token Revoked
message TokenRevokedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string token_id = 2;
  string user_id = 3;
  string tenant_id = 4;
  string revoked_by = 5;
  google.protobuf.Timestamp revoked_at = 6;
  string reason = 7;
}

// Event: Session Created
message SessionCreatedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;

  message SessionData {
    string session_id = 1;
    string user_id = 2;
    string tenant_id = 3;
    google.protobuf.Timestamp created_at = 4;
    google.protobuf.Timestamp expires_at = 5;
    string ip_address = 6;
    string user_agent = 7;
    map<string, string> attributes = 8;
  }

  SessionData session = 2;
}

// Event: Session Expired
message SessionExpiredEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string session_id = 2;
  string user_id = 3;
  string tenant_id = 4;
  google.protobuf.Timestamp expired_at = 5;
  string expiry_reason = 6;  // timeout, max_age, revoked
}

// Event: Account Locked
message AccountLockedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string user_id = 2;
  string tenant_id = 3;
  string lock_reason = 4;
  google.protobuf.Timestamp locked_at = 5;
  google.protobuf.Timestamp unlock_at = 6;
  int32 failed_attempts = 7;
}

// Event: Account Unlocked
message AccountUnlockedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string user_id = 2;
  string tenant_id = 3;
  string unlocked_by = 4;
  google.protobuf.Timestamp unlocked_at = 5;
  string unlock_reason = 6;
}