syntax = "proto3";

package com.nnipa.proto.tenant;

option java_package = "com.nnipa.proto.tenant";
option java_multiple_files = true;

import "google/protobuf/timestamp.proto";
import "common/common.proto";

// Shared TenantData message used across events
message TenantData {
  string tenant_id = 1;
  string tenant_code = 2;
  string name = 3;
  string organization_type = 4;
  string status = 5;
  google.protobuf.Timestamp created_at = 6;

  // Optional fields
  string display_name = 7;
  string organization_email = 8;
  string country = 9;
  string isolation_strategy = 10;
  int32 max_users = 11;
  int32 storage_quota_gb = 12;
}

// Shared SubscriptionData message used across events
message SubscriptionData {
  string subscription_id = 1;
  string tenant_id = 2;
  string plan = 3;
  string status = 4;
  google.protobuf.Timestamp start_date = 5;

  // Optional fields
  google.protobuf.Timestamp end_date = 6;
  double monthly_price = 7;
  string currency = 8;
  string billing_cycle = 9;
  google.protobuf.Timestamp next_renewal_date = 10;
  bool auto_renew = 11;
}

// Event: Tenant Created
message TenantCreatedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  TenantData tenant = 2;
}

// Event: Tenant Creation Response (for async tenant creation)
message TenantCreationResponseEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string user_id = 2;
  string tenant_id = 3;
  string tenant_code = 4;
  string organization_name = 5;
  string status = 6; // SUCCESS, FAILED
  string error_message = 7; // Only populated when status is FAILED
}

// Event: Tenant Updated
message TenantUpdatedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  TenantData tenant = 2;
  string updated_by = 3;
  google.protobuf.Timestamp updated_at = 4;
}

// Event: Tenant Activated
message TenantActivatedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string tenant_id = 2;
  string tenant_code = 3;
  string activated_by = 4;
  google.protobuf.Timestamp activated_at = 5;
}

// Event: Tenant Suspended (completing the definition)
message TenantSuspendedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string tenant_id = 2;
  string tenant_code = 3;
  string reason = 4;
  string suspended_by = 5;
  google.protobuf.Timestamp suspended_at = 6;
}

// Event: Tenant Deleted
message TenantDeletedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string tenant_id = 2;
  string tenant_code = 3;
  string deleted_by = 4;
  google.protobuf.Timestamp deleted_at = 5;
  bool permanent = 6;
}

// Event: Tenant Reactivated
message TenantReactivatedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string tenant_id = 2;
  google.protobuf.Timestamp reactivated_at = 3;
  string reactivated_by = 4;
}

// Event: Tenant Deactivated (for backward compatibility)
message TenantDeactivatedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string tenant_id = 2;
  string reason = 3;
  google.protobuf.Timestamp deactivated_at = 4;
  string deactivated_by = 5;
}

// Event: Subscription Created
message SubscriptionCreatedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  SubscriptionData subscription = 2;
}

// Event: Subscription Updated
message SubscriptionUpdatedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  SubscriptionData subscription = 2;
  string previous_plan = 3;
  google.protobuf.Timestamp updated_at = 4;
}

// Event: Subscription Cancelled
message SubscriptionCancelledEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string subscription_id = 2;
  string tenant_id = 3;
  string plan = 4;
  string reason = 5;
  google.protobuf.Timestamp cancelled_at = 6;
  google.protobuf.Timestamp effective_date = 7;
}

// Event: Subscription Renewed
message SubscriptionRenewedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string subscription_id = 2;
  string tenant_id = 3;
  string plan = 4;
  google.protobuf.Timestamp renewed_at = 5;
  google.protobuf.Timestamp next_renewal_date = 6;
}

// Event: Feature Enabled
message FeatureEnabledEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string tenant_id = 2;
  string feature_code = 3;
  string feature_name = 4;
  string category = 5;
  google.protobuf.Timestamp enabled_at = 6;
  bool trial_enabled = 7;
  int32 trial_days = 8;
}

// Event: Feature Disabled
message FeatureDisabledEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string tenant_id = 2;
  string feature_code = 3;
  string reason = 4;
  google.protobuf.Timestamp disabled_at = 5;
}

// Event: Feature Updated
message FeatureUpdatedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string tenant_id = 2;
  string feature_code = 3;
  string feature_name = 4;
  map<string, string> updated_settings = 5;
  google.protobuf.Timestamp updated_at = 6;
  string updated_by = 7;
}

// Event: Tenant Subscription Changed (for plan changes)
message TenantSubscriptionChangedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;

  message SubscriptionData {
    string tenant_id = 1;
    string old_plan = 2;
    string new_plan = 3;
    google.protobuf.Timestamp changed_at = 4;
    google.protobuf.Timestamp effective_date = 5;
    google.protobuf.Timestamp next_billing_date = 6;
    string changed_by = 7;
    string change_reason = 8;
  }

  SubscriptionData subscription_data = 2;
}

// Event: Tenant Migrated (for isolation strategy changes)
message TenantMigratedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;

  message MigrationData {
    string tenant_id = 1;
    string from_strategy = 2;
    string to_strategy = 3;
    google.protobuf.Timestamp started_at = 4;
    google.protobuf.Timestamp completed_at = 5;
    string status = 6;
    map<string, string> migration_metadata = 7;
  }

  MigrationData migration = 2;
}

// Event: Tenant Billing Failed (for tenant-specific billing events)
message TenantBillingFailedEvent {
  com.nnipa.proto.common.EventMetadata metadata = 1;
  string tenant_id = 2;
  string subscription_id = 3;
  double amount = 4;
  string currency = 5;
  int32 failed_count = 6;
  string failure_reason = 7;
  google.protobuf.Timestamp failed_at = 8;
  google.protobuf.Timestamp next_retry_at = 9;
}